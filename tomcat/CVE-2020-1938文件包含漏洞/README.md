## CVE-2020-1938文件包含漏洞

**漏洞描述**

该漏洞是由于Tomcat AJP协议存在缺陷而导致，攻击者利用该漏洞可通过构造特定参数，读取服务器webapp下的任意文件，如:webapp配置文件或源代码等。若目标服务器同时存在文件上传功能，攻击者可进一步实现远程代码执行。

**漏洞影响版本**

```
Apache Tomcat 6
Apache Tomcat 7 < 7.0.100
Apache Tomcat 8 < 8.5.51
Apache Tomcat 9 < 9.0.31
```

**不受影响版本**

```
Apache Tomcat = 7.0.100
Apache Tomcat = 8.5.51
Apache Tomcat = 9.0.31
```

**漏洞分析**

Tomcat在处理ajp协议时存在漏洞，可通过调用request.setAttribute为Tomcat设置任意request属性。复现发现Tomcat ajp协议存在web目录下任意文件读取漏洞以及JSP文件包含漏洞。
当ajp URI设置为非jsp路径时，Tomcat会调用DefaultServlet处理，此时会导致web目录任意文件读取漏洞。

当ajp URI设置为jsp路径时，Tomcat会调用JspServlet处理，此时会导致JSP文件包含漏洞

使用poc扫描目标网站

```
下载地址: https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi
```

**防御方式**

 1.禁用AJP协议，在tomcat安装路径中找到/conf/server.xml文件，删除或注释下面这行代码：`<Connector port="8009"protocol="AJP/1.3" redirectPort="8443" />`
 2.升级到tomcat最新版本
 3.配置secret来设置AJP协议的认证凭证，如：

```xml
<Connector port="8009"protocol="AJP/1.3"  redirectPort="8443"address="YOUR_TOMCAT_IP_ADDRESS"  secret="YOUR_TOMCAT_AJP_SECRET"/>
```

## 
